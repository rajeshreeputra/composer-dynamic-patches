# composer-dynamic-patches

This plugin allows you to provide patches for any package from any package.

If you don't want a patch package outside the root package, consider providing it as package in the [repositories key](https://getcomposer.org/doc/04-schema.md#repositories)

## Provide patches by package only
```json
{
    "name": "rajeshreeputra/package",
    "type": "metapackage",
    "require": {
        "vendor/package-patches": "~1.0"
    },
    "extra": {
        "patches": {
            "vendor/package-patches": [
                {
                    "This is patch 1": "url/to/file1.patch",
                    "This is patch 2": "url/to/file2.patch"
                }
            ]
        }
    }
}
```

## Provide patches by package and versions or version constraints
You may provide patches per package and optionally by version constraints:
***
composer.json:
```json
{
    "name": "rajeshreeputra/package",
    "type": "metapackage",
    "require": {
        "vendor/package-patches": "~1.0"
    },
    "extra": {
        "patches": {
            "vendor/package-patches":     {
                "1.0.0": {
                    "This is patch 1.0.0 - 1": "url/to/file1.patch",
                    "This is patch 1.0.0 - 2": "url/to/file2.patch"
                },
                "1.0.5": {
                    "This is patch 1.0.5 - 1": "url/to/file1.patch",
                    "This is patch 1.0.5 - 2": "url/to/file2.patch"
                },
                "1.1.2": {
                    "This is patch 1.1.2 - 1": "url/to/file1.patch",
                    "This is patch 1.1.2 - 2": "url/to/file2.patch"
                }
                "1.1.*": {
                    "This is patch 1.1.* - 1": "url/to/file1.patch",
                    "This is patch 1.1.* - 2": "url/to/file2.patch"
                }
            }
        }
    }
}
```

**Note**: *When multiple version constraints match the version of the target package, all of the matching patches will be applied (canonicalized by theyr checksums, so no duplicates should occure).*

## Provide patches from URLs or paths

You can put any part of the patches object into another JSON and load it via an URL (or a path):

```json
{
    "name": "rajeshreeputra/package",
    "type": "project",
    "require": {
        "vendor/package-patches": "~1.0"
    },
    "extra": {
        "extra": {
            "patches-file": "url/to/file/patch.json"
        }
    }
}
```

http://url/to/file/patches.json
```json
{
    "vendor/package-patches": {
        "1.0.0": {
            "This is patch 1.0.0 - 1": "url/to/file1.patch",
            "This is patch 1.0.0 - 2": "url/to/file2.patch"
        },
        "1.0.5": {
            "This is patch 1.0.5 - 1": "url/to/file1.patch",
            "This is patch 1.0.5 - 2": "url/to/file2.patch"
        },
        "1.1.2": {
            "This is patch 1.1.2 - 1": "url/to/file1.patch",
            "This is patch 1.1.2 - 2": "url/to/file2.patch"
        }
        "1.1.*": {
            "This is patch 1.1.* - 1": "url/to/file1.patch",
            "This is patch 1.1.* - 2": "url/to/file2.patch"
        }
    }
}
```

## Provide patches from local stored files
You can use absolute paths or paths relative to the application root.

composer.json:
```json
{
    "name": "rajeshreeputra/package",
    "type": "project",
    "require": {
        "vendor/package-patches": "~1.0"
    },
    "extra": {
        "patches": {
            "vendor/package-patches": {
                "This is local patch": "./patches/file.patch"
            }
        }
    }
}
```
I have also added a new folder at the same level as the composer.json called "patches" and add a patch file file.json like:

```
# This patch file was generated by NetBeans IDE
# It uses platform neutral UTF-8 encoding and \n newlines.
--- a/src/SomeFile.php
+++ b/src/SomeFile.php
@@ -6,7 +6,7 @@
 	{
 		// apply patch to
 		// next line
-		// This is old line
+		// This is new line
 		// some text
 		// some text
 		// some text

```

*Note* that the patch will be called with the option -p1 (remove the first slash) and in the directory of the library.

Then run the commands to update the dependency and to install patches:
```
composer update vendor/package-patches
composer prl
composer prp
```
